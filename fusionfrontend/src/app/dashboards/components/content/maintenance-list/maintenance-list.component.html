<div>
  <div class="p-grid p-jc-between header-line">
    <h3 class="table-header">{{ 'APP.DASHBOARDS.MAINTENANCE_LIST.TABLE_HEADER' | translate }}</h3>
    <div class="p-grid">
      <div class="inner-button">
        <app-table-group-by [fields]="fields" [assetsToBeGrouped]="factoryAssetDetailsWithFields"
                            (enumSelected)="groupAssets($event)">
        </app-table-group-by>
      </div>
      <div class="outer-button">
        <app-table-filter [tableFilters]="tableFilters" [itemsToBeFiltered]="factoryAssetDetailsWithFields"
                          (filteredItems)="filterAssets($event)">
        </app-table-filter>
      </div>
    </div>
  </div>

  <p-treeTable *ngIf="!groupByActive"
               [alwaysShowPaginator]="true"
               [pageLinks]="5"
               [paginator]="true"
               [rowsPerPageOptions]="rowsPerPageOptions"
               [rows]="rowCount"
               [showCurrentPageReport]="true"
               [value]="treeData"
               (onPage)="updateRowCountInUrl($event.rows)"
               class="list-container"
               currentPageReportTemplate="{first} {{ 'APP.COMMON.TABLE.PAGINATION.TO' | translate }} {last}
            {{ 'APP.COMMON.TABLE.PAGINATION.OF' | translate }} {totalRecords} {{ 'APP.COMMON.TERMS.ASSETS' | translate }}"
               (sortFunction)="customSort($event)"
               [customSort]="true">
    <ng-template pTemplate="header">
      <tr>
        <th [style.width.%]="2"></th>
        <th [style.width.%]="3"></th>
        <th [style.width.%]="20" class="first-header-item">
          <app-table-searchbar filterColumn="Asset" [itemsToBeFiltered]="factoryAssetDetailsWithFields"
                               attributeToBeSearched="name" [searchText]="searchText" (searchByName)="searchAssets($event)"
                               (emitSearchText)="setSearchText($event)">
          </app-table-searchbar>
        </th>
        <th [style.width.%]="20" ttSortableColumn="category">{{ 'APP.COMMON.TERMS.ASSET_TYPE' | translate }}
          <p-treeTableSortIcon field="category"></p-treeTableSortIcon>
        </th>
        <th [style.width.%]="15" ttSortableColumn="manufacturer">{{ 'APP.COMMON.TERMS.MANUFACTURER' | translate }}
          <p-treeTableSortIcon field="manufacturer"></p-treeTableSortIcon>
        </th>
        <th [style.width.%]="12" ttSortableColumn="factorySiteName">{{  'APP.COMMON.TERMS.FACTORY_SITE' | translate }}
          <p-treeTableSortIcon field="factorySiteName"></p-treeTableSortIcon>
        </th>
        <th [style.width.%]="15" ttSortableColumn="daysTillMaintenance">{{ 'APP.DASHBOARDS.MAINTENANCE_LIST.DAYS_TILL_MAINTENANCE' | translate }}
          <p-treeTableSortIcon field="daysTillMaintenance"></p-treeTableSortIcon>
        </th>
        <th [style.width.%]="15" ttSortableColumn="operatingHoursTillMaintenance">{{ 'APP.DASHBOARDS.MAINTENANCE_LIST.OPERATING_HOURS_TILL_MAINTENANCE' | translate }}
          <p-treeTableSortIcon field="operatingHoursTillMaintenance"></p-treeTableSortIcon>
        </th>
        <th [style.width.%]="3"></th>
      </tr>
    </ng-template>
    <ng-template let-rowData="rowData" let-rowNode pTemplate="body">
      <tr [ttRow]="rowNode">
        <td [style.width.%]="2"></td>
        <td [style.width.%]="3">
          <app-alert-icon [severity]="getMaxOpenAlertSeverity(rowNode.node)"></app-alert-icon>
        </td>
        <td [ngClass]="{'asset-needs-maintenance': isMaintenanceNeededSoon(rowNode.node)}"
            class="asset-column p-flex-row table-bold-font">
          <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
          <span *ngIf="rowNode.parent" class="subsystem-grid p-col-">
            <span class="upper"></span>
            <span [ngClass]="{'last-element': isLastChildElement(rowNode)}" class="lower"></span>
          </span>
          <span class="p-col">{{rowData.name}}</span>
        </td>
        <td [style.width.%]="20">{{rowData.category}}</td>
        <td [style.width.%]="15">{{rowData.manufacturer}}</td>
        <td [style.width.%]="12">{{rowData.factorySiteName}}</td>
        <td [style.width.%]="13">
          <span class="progressbar-wrapper">
            <app-maintenance-progressbar [asset]="rowData" [type]="utils.maintenanceDays"></app-maintenance-progressbar>
            <span *ngIf="isChildrenMaintenanceNeededSoon(rowNode.node)" class="progressbar-icon">
              <fa-icon (click)="openNode(rowNode.node)" *ngIf="rowNode.node.expanded" [icon]="faChevronCircleDown"
                       class="fa-fw"></fa-icon>
              <fa-icon (click)="openNode(rowNode.node)" *ngIf="!rowNode.node.expanded" [icon]="faChevronCircleUp"
                       class="fa-fw"></fa-icon>
            </span>
          </span>
        </td>
        <td [style.width.%]="13">
          <app-maintenance-progressbar [asset]="rowData" [type]="utils.maintenanceHours"></app-maintenance-progressbar>
        </td>
        <td [style.width.%]="3"></td>
      </tr>
    </ng-template>
  </p-treeTable>
</div>

